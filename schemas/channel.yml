$schema: "http://json-schema.org/draft-06/schema"

type: object
additionalProperties: false
required: ['channel_id', 'name', 'biography']

_zoo_primarykey: 'channel_id'

_zoo_relations:
  - object_field: 'relations.parents'
    to_object_type: 'channel'
    relation_primary_key_field: 'channel_id'
    relation_add_object_field: 'channel'
    backreference:
      field: 'relations.children'

  - object_field: 'relations.friends'
    to_object_type: 'channel'
    relation_primary_key_field: 'channel_id'
    relation_add_object_field: 'channel'
    backreference:
      field: 'relations.friend_of'

  - object_field: 'relations.spouse'
    to_object_type: 'channel'
    relation_primary_key_field: true # true === value of 'spouse' is directly the person ID
    allow_null: true # a person might not have a spouse
    backreference: null # Both spouses must declare each other as spouse, no
                        # auto back-refs


properties:

  # every person entry must have a unique id which will never change.
  channel_id:
    type: string
    pattern: '^[a-z0-9_.-]+$'
    _single_line_string: true
    _description: >-
      An internal identifier for the person.  It must be unique across all
      persons.

  name:
    type: string
    _flm: standalone
    _single_line_string: true
    _description: >-
      The name of the code.  It is listed in multiple places, so don't make it
      too long.

  biography:
    type: string
    _flm: full
    _description: >-
      A short biography of this channel.

  kraus_operators:
    type: string
    _flm: full
    _description: >-
      Describe Kraus operators for the channel.

  isometry:
    type: string
    _flm: full
    _description: >-
      Describe an isometry for the channel.

  choi_state:
    type: string
    _flm: full
    _description: >-
      Describe Choi state for the channel.

  dimensions:
    type: string
    _flm: full
    _description: >-
      Dimensions of input, output and minimal environment.

  wiki_link:
    type: string
    _flm: standalone
    _single_line_string: true
    _description: >-
      A link to the channel's Wikipedia page.

  quantum_capacity:
    type: string
    _flm: full
    _description: >-
      Describe what is known about the quantum capacity for the channel.

  private_capacity:
    type: string
    _flm: full
    _description: >-
      Describe what is known about the private capacity for the channel.

  classical_capacity:
    type: string
    _flm: full
    _description: >-
      Describe what is known about the classical capacity for the channel.

  #
  # Relations:
  #
  relations:
    type: object
    additionalProperties: false
    properties:
      parents:

        type: array
        items:
          type: object
          required: ['channel_id']
          additionalProperties: false
          properties:
            channel_id:
              _single_line_string: true
              type: string

            channel:
              _auto_populated: true

      spouse:
        type: string
        _single_line_string: true

      friends:

        type: array
        items:
          type: object
          required: ['channel_id']
          additionalProperties: false
          properties:
            channel_id:
              _single_line_string: true
              type: string

            channel:
              _auto_populated: true

            friend_detail:
              type: string
              _flm: full
              _description: >-
                Describe how these two people got to know each other as friends.
          

      # automatically populated fields, don't specify manually
      children:
        _auto_populated: true
        type: array
        items:
          type: object

      friend_of:
        _auto_populated: true
        type: array
        items:
          type: object
          properties:
            friend_detail:
              _flm: full
            # (we also have further autopopulated relation object fields
            # including 'channel_id', no need to specify them here)
        
